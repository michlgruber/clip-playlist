<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Clip-Playlist</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
  #playlist { list-style: none; padding: 0; margin: 20px auto; width: 700px; }
  #playlist li {
    padding: 10px; margin: 6px 0;
    background: #f0f0f0; border: 1px solid #ccc;
    display: flex; flex-wrap: wrap; gap: 6px;
    align-items: center;
  }
  input[type="text"], input[type="number"] { width: 120px; }
  button { cursor: pointer; }
</style>
</head>
<body>

<h1>Clip-Playlist</h1>

<div>
  <input id="videoUrl" placeholder="YouTube-Link" size="42">
  Start <input id="startTime" type="number" value="0">
  End <input id="endTime" type="number" value="10">
  Kommentar <input id="comment" type="text" maxlength="150" placeholder="Kommentar max. 150 Zeichen">
  <button onclick="addClip()">âž• Clip</button>
</div>

<ul id="playlist"></ul>

<div>
  <button onclick="playPlaylist()">â–¶ Playlist starten</button>
  <button onclick="savePlaylist()">ðŸ’¾ Playlist speichern</button>
  <button onclick="loadPlaylist()">ðŸ“‚ Playlist laden</button>
</div>

<div id="player"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
const videoUrl  = document.getElementById("videoUrl");
const startTime = document.getElementById("startTime");
const endTime   = document.getElementById("endTime");
const comment   = document.getElementById("comment");
const playlist  = document.getElementById("playlist");

let clips = [];
let current = 0;
let player = null;

/* ===== YouTube API ===== */
function onYouTubeIframeAPIReady() {}

/* ===== Clip hinzufÃ¼gen ===== */
function addClip() {
  const url = videoUrl.value.trim();
  const start = Number(startTime.value) || 0;
  const end   = Number(endTime.value) || start + 10;
  const comm  = comment.value.trim();

  if(comm.length > 150) {
    alert("Kommentar darf maximal 150 Zeichen haben.");
    return;
  }

  const match = url.match(/(?:v=|\.be\/)([a-zA-Z0-9_-]{11})/);
  if (!match) {
    alert("UngÃ¼ltiger YouTube-Link");
    return;
  }

  clips.push({ id: match[1], start, end, comment: comm });
  videoUrl.value = "";
  startTime.value = 0;
  endTime.value = 10;
  comment.value = "";
  render();
}

/* ===== Playlist anzeigen ===== */
function render() {
  playlist.innerHTML = "";
  clips.forEach((c, i) => {
    const li = document.createElement("li");
    li.innerHTML = `
      ${c.id}
      Start <input type="number" value="${c.start}" onchange="edit(${i},'start',this.value)">
      End <input type="number" value="${c.end}" onchange="edit(${i},'end',this.value)">
      Kommentar <input type="text" value="${c.comment}" maxlength="150" onchange="edit(${i},'comment',this.value)">
      <button onclick="removeClip(${i})">âœ–</button>
    `;
    playlist.appendChild(li);
  });
}

/* ===== Player erzeugen ===== */
function ensurePlayer(videoId) {
  if (!player) {
    player = new YT.Player('player', {
      height: '450',
      width: '800',
      videoId,
      playerVars: { origin: location.origin },
      events: { onStateChange }
    });
  }
}

/* ===== Playlist abspielen ===== */
function playPlaylist() {
  if (!clips.length) return;
  current = 0;
  playClip(current);
}

function playClip(i) {
  const c = clips[i];
  ensurePlayer(c.id);
  player.loadVideoById({
    videoId: c.id,
    startSeconds: c.start,
    endSeconds: c.end
  });
}

/* ===== Weiter zum nÃ¤chsten Clip ===== */
function onStateChange(e) {
  if (e.data === YT.PlayerState.ENDED) {
    current++;
    if (current < clips.length) playClip(current);
  }
}

/* ===== Bearbeiten & LÃ¶schen ===== */
function edit(i, k, v) { clips[i][k] = k === 'comment' ? v : Number(v); }
function removeClip(i) { clips.splice(i, 1); render(); }

/* ===== Speichern / Laden ===== */
function savePlaylist() {
  localStorage.setItem('clipPlaylist', JSON.stringify(clips));
  alert("Playlist gespeichert!");
}

function loadPlaylist() {
  const data = localStorage.getItem('clipPlaylist');
  if(data) {
    clips = JSON.parse(data);
    render();
    alert("Playlist geladen!");
  } else {
    alert("Keine gespeicherte Playlist gefunden.");
  }
}
</script>

</body>
</html>
